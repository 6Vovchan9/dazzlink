import{Aa as te,Ba as ce,Ca as me,Ga as ae,Ha as ge,Ia as de,Na as ue,Oa as he,aa as ie,db as pe,e as le,ka as oe,qa as Z,sa as ee,wa as re,ya as ne,za as se}from"./chunk-NVZOHAZI.js";var V=class{rgbaToThumbHash(e,t,l){if(e>100||t>100)throw new Error(`${e}x${t} doesn't fit in 100x100`);let{PI:a,round:o,max:r,cos:f,abs:u}=Math,_=0,y=0,g=0,n=0;for(let h=0,d=0;h<e*t;h++,d+=4){let m=l[d+3]/255;_+=m/255*l[d],y+=m/255*l[d+1],g+=m/255*l[d+2],n+=m}n&&(_/=n,y/=n,g/=n);let s=n<e*t,z=s?5:7,$=r(1,o(z*e/r(e,t))),E=r(1,o(z*t/r(e,t))),B=[],v=[],k=[],J=[];for(let h=0,d=0;h<e*t;h++,d+=4){let m=l[d+3]/255,D=_*(1-m)+m/255*l[d],i=y*(1-m)+m/255*l[d+1],c=g*(1-m)+m/255*l[d+2];B[h]=(D+i+c)/3,v[h]=(D+i)/2-c,k[h]=D-i,J[h]=m}let j=(h,d,m)=>{let D=0,i=[],c=0,b=[];for(let p=0;p<m;p++)for(let U=0;U*m<d*(m-p);U++){let G=0;for(let A=0;A<e;A++)b[A]=f(a/e*U*(A+.5));for(let A=0;A<t;A++)for(let Q=0,fe=f(a/t*p*(A+.5));Q<e;Q++)G+=h[Q+A*e]*b[Q]*fe;G/=e*t,U||p?(i.push(G),c=r(c,u(G))):D=G}if(c)for(let p=0;p<i.length;p++)i[p]=.5+.5/c*i[p];return[D,i,c]},[K,P,W]=j(B,r(3,$),r(3,E)),[X,N,Y]=j(v,3,3),[O,q,w]=j(k,3,3),[R,F,S]=s?j(J,5,5):[],H=e>t,x=o(63*K)|o(31.5+31.5*X)<<6|o(31.5+31.5*O)<<12|o(31*W)<<18|s<<23,M=(H?E:$)|o(63*Y)<<3|o(63*w)<<9|H<<15,C=[x&255,x>>8&255,x>>16,M&255,M>>8],I=s?6:5,T=0;s&&C.push(o(15*R)|o(15*S)<<4);for(let h of s?[P,N,q,F]:[P,N,q])for(let d of h)C[I+(T>>1)]|=o(15*d)<<((T++&1)<<2);return new Uint8Array(C)}thumbHashToRGBA(e){let{PI:t,min:l,max:a,cos:o,round:r}=Math,f=e[0]|e[1]<<8|e[2]<<16,u=e[3]|e[4]<<8,_=(f&63)/63,y=(f>>6&63)/31.5-1,g=(f>>12&63)/31.5-1,n=(f>>18&31)/31,s=f>>23,z=(u>>3&63)/63,$=(u>>9&63)/63,E=u>>15,B=a(3,E?s?5:7:u&7),v=a(3,E?u&7:s?5:7),k=s?(e[5]&15)/15:1,J=(e[5]>>4)/15,j=s?6:5,K=0,P=(H,x,M)=>{let C=[];for(let I=0;I<x;I++)for(let T=I?0:1;T*x<H*(x-I);T++)C.push(((e[j+(K>>1)]>>((K++&1)<<2)&15)/7.5-1)*M);return C},W=P(B,v,n),X=P(3,3,z*1.25),N=P(3,3,$*1.25),Y=s&&P(5,5,J),O=this.thumbHashToApproximateAspectRatio(e),q=r(O>1?32:32*O),w=r(O>1?32/O:32),R=new Uint8Array(q*w*4),F=[],S=[];for(let H=0,x=0;H<w;H++)for(let M=0;M<q;M++,x+=4){let C=_,I=y,T=g,h=k;for(let i=0,c=a(B,s?5:3);i<c;i++)F[i]=o(t/q*(M+.5)*i);for(let i=0,c=a(v,s?5:3);i<c;i++)S[i]=o(t/w*(H+.5)*i);for(let i=0,c=0;i<v;i++)for(let b=i?0:1,p=S[i]*2;b*v<B*(v-i);b++,c++)C+=W[c]*F[b]*p;for(let i=0,c=0;i<3;i++)for(let b=i?0:1,p=S[i]*2;b<3-i;b++,c++){let U=F[b]*p;I+=X[c]*U,T+=N[c]*U}if(s)for(let i=0,c=0;i<5;i++)for(let b=i?0:1,p=S[i]*2;b<5-i;b++,c++)h+=Y[c]*F[b]*p;let d=C-2/3*I,m=(3*C-d+T)/2,D=m-T;R[x]=a(0,255*l(1,m)),R[x+1]=a(0,255*l(1,D)),R[x+2]=a(0,255*l(1,d)),R[x+3]=a(0,255*l(1,h))}return{w:q,h:w,rgba:R}}thumbHashToAverageRGBA(e){let{min:t,max:l}=Math,a=e[0]|e[1]<<8|e[2]<<16,o=(a&63)/63,r=(a>>6&63)/31.5-1,f=(a>>12&63)/31.5-1,_=a>>23?(e[5]&15)/15:1,y=o-2/3*r,g=(3*o-y+f)/2,n=g-f;return{r:l(0,t(1,g)),g:l(0,t(1,n)),b:l(0,t(1,y)),a:_}}thumbHashToApproximateAspectRatio(e){let t=e[3],l=e[2]&128,a=e[4]&128,o=a?l?5:7:t&7,r=a?t&7:l?5:7;return o/r}rgbaToDataURL(e,t,l){let a=e*4+1,o=6+t*(5+a),r=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,o>>>24,o>>16&255,o>>8&255,o&255,73,68,65,84,120,1],f=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],u=1,_=0;for(let y=0,g=0,n=a-1;y<t;y++,n+=a-1)for(r.push(y+1<t?0:1,a&255,a>>8,~a&255,a>>8^255,0),_=(_+u)%65521;g<n;g++){let s=l[g]&255;r.push(s),u=(u+s)%65521,_=(_+u)%65521}r.push(_>>8,_&255,u>>8,u&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[y,g]of[[12,29],[37,41+o]]){let n=-1;for(let s=y;s<g;s++)n^=r[s],n=n>>>4^f[n&15],n=n>>>4^f[n&15];n=~n,r[g++]=n>>>24,r[g++]=n>>16&255,r[g++]=n>>8&255,r[g++]=n&255}return"data:image/png;base64,"+btoa(String.fromCharCode(...r))}thumbHashToDataURL(e){let t=this.thumbHashToRGBA(e);return this.rgbaToDataURL(t.w,t.h,t.rgba)}base64ToThumbHash(e){let t=atob(e),l=new Uint8Array(t.length);for(let a=0;a<t.length;a++)l[a]=t.charCodeAt(a);return l}getBinaryThumbHash(e){return le(this,null,function*(){let t=new Image;t.src=e,yield new Promise(u=>t.onload=u);let l=document.createElement("canvas"),a=l.getContext("2d"),o=100/Math.max(t.width,t.height);l.width=Math.round(t.width*o),l.height=Math.round(t.height*o),a.drawImage(t,0,0,l.width,l.height);let r=a.getImageData(0,0,l.width,l.height);return this.rgbaToThumbHash(r.width,r.height,r.data)})}};function _e(L,e){if(L&1&&de(0,"img",1),L&2){let t=he();te("src",t.imageData.metadata.imageBase64,Z)}}var ve=(()=>{let e=class e extends V{constructor(){super(...arguments),this.mainImageLoad=re(!1)}};e.\u0275fac=(()=>{let l;return function(o){return(l||(l=oe(e)))(o||e)}})(),e.\u0275cmp=ie({type:e,selectors:[["app-thumb-hash-image"]],inputs:{imageData:"imageData"},standalone:!0,features:[ne,pe],decls:3,vars:4,consts:[[1,"cityCarouselImage"],["alt","preview",1,"cityCarouselImage__image","cityCarouselImage__image--thumbHash",3,"src"],["alt","pic",1,"cityCarouselImage__image","cityCarouselImage__image--main",3,"load","src"]],template:function(a,o){a&1&&(ae(0,"div",0),se(1,_e,1,1,"img",1),ae(2,"img",2),ue("load",function(){return o.mainImageLoad.set(!0)}),ge()()),a&2&&(ce("cityCarouselImage--mainImageLoad",o.mainImageLoad()),ee(),me(1,o.imageData.metadata!=null&&o.imageData.metadata.imageBase64?1:-1),ee(),te("src",o.imageData.href,Z))},styles:[".cityCarouselImage[_ngcontent-%COMP%]   .cityCarouselImage__image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;position:absolute;transition:opacity 1s}.cityCarouselImage[_ngcontent-%COMP%]   .cityCarouselImage__image--main[_ngcontent-%COMP%]{opacity:0}.cityCarouselImage--mainImageLoad[_ngcontent-%COMP%]   .cityCarouselImage__image--main[_ngcontent-%COMP%]{opacity:1}"]});let L=e;return L})();export{V as a,ve as b};

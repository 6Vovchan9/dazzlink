import{a as B}from"./chunk-FZRHEOYD.js";import{a as De}from"./chunk-EFXP56Z3.js";import{a as Fe}from"./chunk-3SW7NKMZ.js";import{a as Ee}from"./chunk-VHITC66A.js";import"./chunk-DMFGKB5Z.js";import{b as Te,d as Ie,e as Be}from"./chunk-BAXKQD4C.js";import{a as Le}from"./chunk-3YLRU6KE.js";import{Aa as d,Ab as ve,Ba as b,Ca as C,Cb as Me,Ea as U,Fa as W,Ga as a,Gb as we,Ha as s,Hb as Oe,Ia as p,Ja as le,Jb as Se,Ka as ce,La as K,Ma as S,Na as A,Nb as Ae,Oa as u,Q as re,Ra as ue,Sa as pe,Ta as de,Tb as ye,Ua as ge,Va as _e,Wa as E,Wb as H,Xa as g,Xb as ke,Ya as me,Z as G,Za as T,_a as fe,a as j,aa as y,b as R,cb as he,db as I,e as x,f as N,fb as L,g as te,ha as v,i as ne,ia as M,ib as Ce,kb as Pe,na as ae,ob as be,pb as D,qa as k,r as z,sa as c,ta as O,v as ie,vb as xe,wa as P,x as $,xa as se,y as oe,za as _}from"./chunk-NVZOHAZI.js";var Ve=[{id:"6d65891f-624f-48cb-9a1d-705og53bc9ff",title:"\u0421\u0442\u0430\u0442\u044C\u044F 1",viewCount:22,published:new Date("2024-03-12T10:43:04.31")},{id:"a3f799d2-cb68-44b1-8fa6-3dkf5t554f0e",title:"\u0421\u0442\u0430\u0442\u044C\u044F 2",viewCount:122,published:new Date("2024-02-11T11:08:04.31")},{id:"akf999d2-cb68-44b1-8fa6-3dkf5t554f0e",title:"\u0421\u0442\u0430\u0442\u044C\u044F 3",viewCount:2,published:new Date("2024-02-11T11:08:04.31")},{id:"a3f799d2-cb68-44b1-8fa6-3dchwt554f0e",title:"\u0421\u0442\u0430\u0442\u044C\u044F 4",viewCount:52,published:new Date("2024-02-11T11:08:04.31")}];var F=function(e){return e.Load="load",e.Error="error",e.Success="success",e}(F||{});var qe=(e,t,n,i)=>({"post__img--empty":e,"post__img--load":t,"post__img--success":n,"post__img--error":i});function Ye(e,t){if(e&1){let n=S();le(0),a(1,"img",8),A("load",function(){v(n);let r=u();return M(r.onImageLoad())})("error",function(){v(n);let r=u();return M(r.onImageError())}),s(),ce()}if(e&2){let n=u();c(),d("src",n.postData.imageUrl,k)}}function Je(e,t){if(e&1&&(a(0,"div",5),g(1),s()),e&2){let n=u();c(),fe("",n.postData.viewCount," ",n.buildViewCount(n.postData.viewCount),"")}}function Xe(e,t){e&1&&p(0,"img",9)}var je=(()=>{let t=class t{constructor(){this.isLoading=!1,this.state=P(F.Load)}get imageStateTypes(){return F}onImageLoad(){this.state.set(this.imageStateTypes.Success)}onImageError(){this.state.set(this.imageStateTypes.Error)}ngOnInit(){}buildViewCount(i){return`${i}`.endsWith("1")&&+i!=11?" \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440":`${i}`.endsWith("2")&&+i!=12||`${i}`.endsWith("3")&&+i!=13||`${i}`.endsWith("4")&&+i!=14?" \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430":" \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u043E\u0432"}};t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=y({type:t,selectors:[["app-post"]],inputs:{postData:"postData",isLoading:"isLoading"},standalone:!0,features:[I],decls:12,vars:17,consts:[["defaultPostImg",""],[1,"post"],[1,"post__img",3,"ngClass"],[4,"ngIf"],[1,"post__details","postDetails"],[1,"postDetails__info"],["class","postDetails__info",4,"ngIf"],[1,"post__title"],["alt","\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u0441\u0442\u0430\u0442\u044C\u0438",3,"load","error","src"],["src","assets/images/postImg.png","alt","\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u0441\u0442\u0430\u0442\u044C\u0438"]],template:function(r,o){r&1&&(a(0,"div",1)(1,"div",2),_(2,Ye,2,1,"ng-container",3),s(),a(3,"div",4)(4,"div",5),g(5),Pe(6,"date"),s(),_(7,Je,2,2,"div",6),s(),a(8,"div",7),g(9),s()(),_(10,Xe,1,0,"ng-template",null,0,D)),r&2&&(b("post--withSkeleton",o.isLoading),c(),d("ngClass",Ce(12,qe,!o.postData.imageUrl,o.postData.imageUrl&&o.state()===o.imageStateTypes.Load,o.postData.imageUrl&&o.state()===o.imageStateTypes.Success,o.postData.imageUrl&&o.state()===o.imageStateTypes.Error)),c(),d("ngIf",o.postData.imageUrl),c(3),me(be(6,7,o.postData.published,"dd\xA0MMMM\xA0yyyy","","ru")),c(2),d("ngIf",o.postData.viewCount),c(2),T(" ",o.postData.title," "))},dependencies:[ve,Se,Me],styles:['[_ngcontent-%COMP%]:root{--color-blue: #5532EB;--color-blue1: #4A4AC6;--color-pink: #FF99EC;--color-black: #000;--color-black1: #333;--color-black2: #111;--color-white: #fff;--color-gray: #807d7d;--color-gray1: #f2f3f4;--color-red: #e40038;--color-green: green;--color-text-gray: #a8a8a8;--color-light-gray: #eee}.post[_ngcontent-%COMP%]{display:flex;align-items:flex-start;flex-direction:column;cursor:pointer}.post[_ngcontent-%COMP%]   .post__img[_ngcontent-%COMP%]{align-self:stretch;margin-bottom:18px;background-color:var(--color-light-gray);min-height:200px;border-radius:32px;z-index:10;overflow:hidden;aspect-ratio:.7485}.post[_ngcontent-%COMP%]   .post__img--load[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{opacity:0}.post[_ngcontent-%COMP%]   .post__img--success[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{opacity:1;transition:1s}.post[_ngcontent-%COMP%]   .post__img--error[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{opacity:0}.post[_ngcontent-%COMP%]   .post__img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:100%;object-fit:cover;object-position:center}.post[_ngcontent-%COMP%]   .post__details[_ngcontent-%COMP%]{margin-bottom:4px}.post[_ngcontent-%COMP%]   .post__title[_ngcontent-%COMP%]{font-size:28px;line-height:32px;font-weight:700}.post[_ngcontent-%COMP%]:hover   .post__title[_ngcontent-%COMP%]{color:var(--color-blue1)}@media (min-width: 768px){.post[_ngcontent-%COMP%]   .post__img[_ngcontent-%COMP%]{margin-bottom:24px}}.post--withSkeleton[_ngcontent-%COMP%]{cursor:wait;overflow:hidden;position:relative}.post--withSkeleton[_ngcontent-%COMP%]   .post__img[_ngcontent-%COMP%]{position:relative}.post--withSkeleton[_ngcontent-%COMP%]   .post__img[_ngcontent-%COMP%]:before{content:"";position:absolute;width:100%;height:100%;background-color:#fff}.post--withSkeleton[_ngcontent-%COMP%]   .post__img[_ngcontent-%COMP%]:after{content:"";position:absolute;width:100%;height:100%;background-color:#eee;left:0;top:50%;transform:translateY(-50%);border-radius:20px}.post--withSkeleton[_ngcontent-%COMP%]   .post__details[_ngcontent-%COMP%], .post--withSkeleton[_ngcontent-%COMP%]   .post__title[_ngcontent-%COMP%]{position:relative;color:transparent}.post--withSkeleton[_ngcontent-%COMP%]   .post__details[_ngcontent-%COMP%]:before, .post--withSkeleton[_ngcontent-%COMP%]   .post__title[_ngcontent-%COMP%]:before{content:"";position:absolute;width:100%;height:100%;background-color:#fff}.post--withSkeleton[_ngcontent-%COMP%]   .post__details[_ngcontent-%COMP%]:after, .post--withSkeleton[_ngcontent-%COMP%]   .post__title[_ngcontent-%COMP%]:after{content:"";position:absolute;width:100%;height:80%;background-color:#eee;left:0;top:50%;transform:translateY(-50%);border-radius:20px}.postDetails[_ngcontent-%COMP%]{font-size:16px;font-weight:700;margin-bottom:4px;display:flex;flex-wrap:wrap;color:var(--color-text-gray)}.postDetails[_ngcontent-%COMP%]   .postDetails__info[_ngcontent-%COMP%]{margin-left:13px;position:relative}.postDetails[_ngcontent-%COMP%]   .postDetails__info[_ngcontent-%COMP%]:before{content:"";position:absolute;display:block;width:2.5px;height:2.5px;border-radius:50%;background-color:var(--color-text-gray);top:50%;left:0;transform:translate(-7px,-50%)}.postDetails[_ngcontent-%COMP%]   .postDetails__info[_ngcontent-%COMP%]:first-child{margin:0}.postDetails[_ngcontent-%COMP%]   .postDetails__info[_ngcontent-%COMP%]:first-child:before{display:none}.skeletonLoader[_ngcontent-%COMP%]{background-color:transparent}.skeletonLoader[_ngcontent-%COMP%]:before{background-color:transparent}'],changeDetection:0});let e=t;return e})();var Y=(e,t)=>t.some(n=>e instanceof n),Re,Ne;function Ze(){return Re||(Re=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function et(){return Ne||(Ne=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var J=new WeakMap,Q=new WeakMap,V=new WeakMap;function tt(e){let t=new Promise((n,i)=>{let r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",l)},o=()=>{n(w(e.result)),r()},l=()=>{i(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",l)});return V.set(t,e),t}function nt(e){if(J.has(e))return;let t=new Promise((n,i)=>{let r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",l),e.removeEventListener("abort",l)},o=()=>{n(),r()},l=()=>{i(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",l),e.addEventListener("abort",l)});J.set(e,t)}var X={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return J.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return w(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ue(e){X=e(X)}function it(e){return et().includes(e)?function(...t){return e.apply(Z(this),t),w(this.request)}:function(...t){return w(e.apply(Z(this),t))}}function ot(e){return typeof e=="function"?it(e):(e instanceof IDBTransaction&&nt(e),Y(e,Ze())?new Proxy(e,X):e)}function w(e){if(e instanceof IDBRequest)return tt(e);if(Q.has(e))return Q.get(e);let t=ot(e);return t!==e&&(Q.set(e,t),V.set(t,e)),t}var Z=e=>V.get(e);function We(e,t,{blocked:n,upgrade:i,blocking:r,terminated:o}={}){let l=indexedDB.open(e,t),h=w(l);return i&&l.addEventListener("upgradeneeded",m=>{i(w(l.result),m.oldVersion,m.newVersion,w(l.transaction),m)}),n&&l.addEventListener("blocked",m=>n(m.oldVersion,m.newVersion,m)),h.then(m=>{o&&m.addEventListener("close",()=>o()),r&&m.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),h}var rt=["get","getKey","getAll","getAllKeys","count"],at=["put","add","delete","clear"],q=new Map;function ze(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(q.get(t))return q.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=at.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||rt.includes(n)))return;let o=function(l,...h){return x(this,null,function*(){let m=this.transaction(l,r?"readwrite":"readonly"),f=m.store;return i&&(f=f.index(h.shift())),(yield Promise.all([f[n](...h),r&&m.done]))[0]})};return q.set(t,o),o}Ue(e=>R(j({},e),{get:(t,n,i)=>ze(t,n)||e.get(t,n,i),has:(t,n)=>!!ze(t,n)||e.has(t,n)}));var st=["continue","continuePrimaryKey","advance"],$e={},ee=new WeakMap,Ke=new WeakMap,lt={get(e,t){if(!st.includes(t))return e[t];let n=$e[t];return n||(n=$e[t]=function(...i){ee.set(this,Ke.get(this)[t](...i))}),n}};function ct(...e){return te(this,null,function*(){let t=this;if(t instanceof IDBCursor||(t=yield new N(t.openCursor(...e))),!t)return;t=t;let n=new Proxy(t,lt);for(Ke.set(n,t),V.set(n,Z(t));t;)yield n,t=yield new N(ee.get(n)||t.continue()),ee.delete(n)})}function Ge(e,t){return t===Symbol.asyncIterator&&Y(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Y(e,[IDBIndex,IDBObjectStore])}Ue(e=>R(j({},e),{get(t,n,i){return Ge(t,n)?ct:e.get(t,n,i)},has(t,n){return Ge(t,n)||e.has(t,n)}}));var ut=["restoreScrollPosition"],pt=["lastPostItem"];function dt(e,t){return this.trackPost}var gt=(e,t)=>t.id,_t=e=>({"--header-height":e}),He=e=>["/media",e];function mt(e,t){if(e&1&&(a(0,"div",16,2),p(2,"app-header"),s()),e&2){let n=E(1),i=u();b("articlesPage__header--visible",!i.hideHeader()),d("ngStyle",L(3,_t,-(n.clientHeight||0)+"px"))}}function ft(e,t){if(e&1){let n=S();a(0,"button",17),A("click",function(){v(n);let r=u();return M(r.qrModalOrTelegram())}),p(1,"img",18),g(2," \u041F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u043F\u043E\u0434\u0430\u0440\u043E\u043A "),s()}}function ht(e,t){e&1&&(a(0,"div",19)(1,"div",25)(2,"a",26),p(3,"img",27),s(),a(4,"a",28),p(5,"img",29),s(),a(6,"a",30),p(7,"img",31),s()()())}function Ct(e,t){if(e&1){let n=S();_(0,ht,8,0,"div",19),a(1,"div",20)(2,"div",21),A("click",function(){v(n);let r=u();return M(r.mobileDetectService==null?null:r.mobileDetectService.goToDeviceStore())}),a(3,"div",22),g(4,"\u0421\u043A\u0430\u0447\u0430\u0439\u0442\u0435"),p(5,"br"),g(6,"\u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u0435"),s(),a(7,"div",23),p(8,"img",24),s()()()}if(e&2){let n=u();C(0,n.appWebview?-1:0),c(8),d("src",n.mobileDetectService==null?null:n.mobileDetectService.mobileStoreIconSrc(),k)}}function Pt(e,t){if(e&1){let n=S();a(0,"div",15),p(1,"div",32),a(2,"div",33),g(3," \u0415\u0441\u0442\u044C \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0430 "),s(),a(4,"div",34),g(5," \u041D\u0435 \u0441\u043C\u043E\u0433\u043B\u0438 \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0441\u0442\u0430\u0442\u044C\u0438, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435"),p(6,"br"),g(7," \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 \u0438\u043B\u0438 \u0437\u0430\u0439\u0434\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435 "),s(),a(8,"button",35),A("click",function(){v(n);let r=u();return M(r.reloadArticles())}),g(9," \u041F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C "),p(10,"img",36),s()()}if(e&2){let n=u();c(8),b("errorMessage__btn--isLoading",n.isLoading()),d("disabled",n.isLoading())}}function bt(e,t){e&1&&K(0)}function xt(e,t){if(e&1&&_(0,bt,1,0,"ng-container",37),e&2){u(2);let n=E(19);d("ngTemplateOutlet",n)}}function vt(e,t){if(e&1&&(a(0,"li",40,4)(2,"a",41),p(3,"app-post",42),s()()),e&2){let n=u().$implicit,i=u(4);b("pageContent__itemOfArticle--viewed",i.checkViewedOrNot(n.id)),c(2),d("routerLink",L(4,He,n.pageName)),c(),d("postData",n)}}function Mt(e,t){if(e&1&&(a(0,"li",43)(1,"a",44),p(2,"app-post",42),s()()),e&2){let n=u().$implicit,i=u(4);b("pageContent__itemOfArticle--viewed",i.checkViewedOrNot(n.id)),c(),d("routerLink",L(4,He,n.pageName)),c(),d("postData",n)}}function wt(e,t){if(e&1&&_(0,vt,4,6,"li",39)(1,Mt,3,6),e&2){let n=t.$index,i=t.$count;C(0,n===i-1?0:1)}}function Ot(e,t){if(e&1&&(a(0,"li",43)(1,"a",45),p(2,"app-post",46),s()(),a(3,"li",47)(4,"a",45),p(5,"app-post",46),s()()),e&2){let n=u(4);c(2),d("postData",n.mockArticlesList[0])("isLoading",!0),c(3),d("postData",n.mockArticlesList[0])("isLoading",!0)}}function St(e,t){if(e&1&&(a(0,"ul",38,3),U(2,wt,2,1,null,null,dt,!0),_(4,Ot,6,4),s()),e&2){let n=u(3);c(2),W(n.articlesList()),c(2),C(4,n.showLoadMoreSpinner()?4:-1)}}function At(e,t){e&1&&K(0)}function Dt(e,t){if(e&1&&_(0,At,1,0,"ng-container",37),e&2){u(3);let n=E(17);d("ngTemplateOutlet",n)}}function yt(e,t){if(e&1&&_(0,St,5,1,"ul",38)(1,Dt,1,1),e&2){let n,i=u(2);C(0,(n=i.articlesList())!=null&&n.length?0:1)}}function kt(e,t){if(e&1&&_(0,xt,1,1,"ng-container")(1,yt,2,1),e&2){let n=u();C(0,n.isLoading()?0:1)}}function Et(e,t){e&1&&p(0,"app-footer")}function Tt(e,t){e&1&&(a(0,"div",15),p(1,"div",32),a(2,"div",33),g(3," \u041F\u043E\u043A\u0430 \u043D\u0438\u0447\u0435\u0433\u043E \u043D\u0435\u0442 "),s(),a(4,"div",34),g(5," \u0421\u0435\u0439\u0447\u0430\u0441 \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0443\u0441\u0442, \u043D\u043E \u043C\u044B \u0443\u0436\u0435 \u0441\u043E\u0431\u0438\u0440\u0430\u0435\u043C"),p(6,"br"),g(7," \u043F\u043E\u043B\u0435\u0437\u043D\u044B\u0439 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B, \u0437\u0430\u0439\u0434\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435 "),s(),a(8,"button",48),g(9,"\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E"),s()())}function It(e,t){if(e&1&&(a(0,"li",43)(1,"a",45),p(2,"app-post",46),s()()),e&2){let n=t.$implicit;c(2),d("postData",n)("isLoading",!0)}}function Lt(e,t){if(e&1&&(a(0,"ul",49),U(1,It,3,2,"li",43,gt),s()),e&2){let n=u();c(),W(n.mockArticlesList)}}var Cn=(()=>{let t=class t{constructor(i,r,o,l,h){this.postsService=i,this.persistanceService=r,this.mobileDetectService=o,this.modalService=l,this.vc=h,this.articlesList=P([]),this.mockArticlesList=Ve,this.lastPaginationPage=!0,this.searchStr="",this.isLoading=P(!0),this.prevScrollTop=0,this.hideHeader=P(!0),this.errorAfterGetAllArticles=P(!1),this.implementErrorInGetAllArticles=!1,this.showLoadMoreSpinner=P(!1),this.destroy$=new ne,this.hideScrollProgress=!0,this.router=G(H),this.scrollingRef=se("restoreScrollPosition");let m=De(G(H).events.pipe($(f=>f instanceof ye),z(f=>f.position)));xe(()=>{this.scrollingRef()&&m()&&this.vc.scrollToPosition(m())})}ngOnInit(){this.getAllArticles(),this.intersectionObserver()}ngAfterViewInit(){this.lastPostSub=this.lastPostList.changes.subscribe(i=>{i.last&&this.observer&&!this.lastPaginationPage&&this.observer.observe(i.last.nativeElement)}),this.addEventListenerToPage()}get appWebview(){return navigator.userAgent.includes("Dazzlink")}aboutIDB(){return x(this,null,function*(){this.db=yield this.openDatabase(),this.getAllFromIDB()})}openDatabase(){return We("articlesDb",void 0,{upgrade(i,r,o,l,h){console.log("\u0421\u043E\u0437\u0434\u0430\u0435\u043C \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435 \u043E\u0431\u044A\u0435\u043A\u0442\u0430!"),i.objectStoreNames.contains("articles")||i.createObjectStore("articles",{autoIncrement:!0})},blocked(i,r,o){},blocking(i,r,o){},terminated(){}})}getAllFromIDB(){return x(this,null,function*(){let o=yield this.db.transaction("articles","readonly").objectStore("articles").getAll();if(o.length){console.log("\u0421\u043F\u0438\u0441\u043E\u043A \u0441\u0442\u0430\u0442\u0435\u0439 \u0438\u0437 indexedDB:",o);let l=o[o.length-1];this.lastPaginationPage=l?.last??!0,this.articlesList.update(h=>[...h,...o]),this.showLoadMoreSpinner.set(!1),this.isLoading.set(!1)}else console.log("\u0412 \u0411\u0414 IndexedDB \u043F\u043E\u043A\u0430 \u043D\u0435\u0442 \u0441\u0442\u0430\u0442\u0435\u0439. \u0417\u0430\u043F\u0440\u043E\u0441\u0438\u043C \u0438\u0445 \u0441 \u0431\u044D\u043A\u0430"),this.getAllArticles()})}addToIDB(i){if(this.db&&i.length){let o=this.db.transaction("articles","readwrite").objectStore("articles");console.log("\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u043D\u043E\u0432\u044B\u0435 \u0441\u0442\u0430\u0442\u044C\u0438 \u0432 IndexedDB"),i[i.length-1].last=this.lastPaginationPage;for(let l of i)o.add(l)}}clearArticlesInIDB(){this.db&&this.db.transaction("articles","readwrite").objectStore("articles").clear()}addEventListenerToPage(){this.appWebview||(this.pageScrollSub=ie(window,"scroll").pipe($(()=>!this.isLoading()),oe(200)).subscribe({next:()=>{this.operatePageScroll()}}))}operatePageScroll(){let[i,r]=this.vc.getScrollPosition();r>this.prevScrollTop||r<100?r<100?r===0&&this.hideHeader.set(!0):this.hideHeader.set(!0):this.hideHeader.set(!1),this.prevScrollTop=r}trackPost(i,r){return r.id}getAllArticles(i,r=!1){this.pSub=this.postsService.getAllProd(i).pipe(re(o=>this.lastPaginationPage=o?.last??!0),z(o=>o.content||[])).subscribe({next:o=>{this.addToIDB(o),this.articlesList.update(l=>[...l,...o]),this.showLoadMoreSpinner.set(!1),this.errorAfterGetAllArticles.set(!1),this.isLoading.set(!1)},error:()=>{this.errorAfterGetAllArticles.set(!0),this.isLoading.set(!1),this.articlesList.set([])}})}reloadArticles(){this.db?this.checkIDBAfterReload():(this.isLoading.set(!0),this.getAllArticles())}goToPostPage(i){this.router.navigate(["/post",i]).then(r=>{})}checkViewedOrNot(i){let r=JSON.parse(localStorage.getItem("articlesEvaluation"));return r?.length?r.find(o=>o.articleId===i):!1}getContent(i){return Ee[i][this.curLang||"RU"]}intersectionObserver(){let i={root:null,rootMargin:"0px",threshold:1};this.observer=new IntersectionObserver(([r],o)=>{r.isIntersecting&&(o.unobserve(r.target),console.log("load more articles..."),this.showLoadMoreSpinner.set(!0),this.checkIDB())},i)}checkIDB(){return x(this,null,function*(){if(this.db){let o=yield this.db.transaction("articles","readonly").objectStore("articles").getAll();if(o.length>this.articlesList().length){console.log(`\u0432 IndexedDB (${o.length}) \u0431\u043E\u043B\u044C\u0448\u0435 \u0441\u0442\u0430\u0442\u0435\u0439 \u0447\u0435\u043C \u043D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435 (${this.articlesList().length}), \u043F\u043E\u044D\u0442\u043E\u043C\u0443 \u0432\u044B\u0432\u043E\u0434\u0438\u043C \u0441\u0442\u0430\u0442\u044C\u0438 \u0438\u0437 \u0411\u0414, \u0430 \u043D\u0435 \u0437\u0430\u043F\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u043C \u0441 \u0431\u044D\u043A\u0430`);let l=o[o.length-1];this.lastPaginationPage=l?.last??!0,this.articlesList.set(o),this.showLoadMoreSpinner.set(!1)}else o.length<this.articlesList().length?console.log("\u0432 IndexedDB \u043C\u0435\u043D\u044C\u0448\u0435 \u0441\u0442\u0430\u0442\u0435\u0439 \u0447\u0435\u043C \u043D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435"):(console.log("\u041D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435 \u0438 \u0432 IndexedDB \u043E\u0434\u0438\u043D\u0430\u043A. \u043A\u043E\u043B-\u0432\u043E \u0441\u0442\u0430\u0442\u0435\u0439, \u0438\u0434\u0435\u043C \u0437\u0430 \u043D\u043E\u0432\u043E\u0439 \u043F\u0430\u0447\u043A\u043E\u0439"),this.getAllArticles({id:this.articlesList()[this.articlesList().length-1].id,direction:"EARLIER"}))}else this.getAllArticles({id:this.articlesList()[this.articlesList().length-1].id,direction:"EARLIER"})})}checkIDBAfterReload(){return x(this,null,function*(){let o=yield this.db.transaction("articles","readonly").objectStore("articles").getAll();if(o.length){console.log(`\u0412 IndexedDB \u0435\u0441\u0442\u044C \u0441\u0442\u0430\u0442\u044C\u0438 (${o.length}), \u0432\u043E\u0437\u044C\u043C\u0435\u043C \u043E\u0442\u0442\u0443\u0434\u0430`);let l=o[o.length-1];this.lastPaginationPage=l?.last??!0,this.articlesList.set(o),this.showLoadMoreSpinner.set(!1),this.errorAfterGetAllArticles.set(!1)}else console.log("\u0412 IndexedDB \u043D\u0435\u0442 \u0441\u0442\u0430\u0442\u0435\u0439, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0435\u043C \u0437\u0430\u043F\u0440\u043E\u0441\u0438\u0442\u044C \u0435\u0449\u0435 \u0440\u0430\u0437 \u0441 \u0431\u044D\u043A\u0430"),this.isLoading.set(!0),this.getAllArticles()})}qrModalOrTelegram(){this.mobileDetectService?.osDevice?this.mobileDetectService.goToTelegramChannel():this.modalService.open({component:"appComponent",modalName:"qrForTelegram"})}ngOnDestroy(){this.pageScrollSub?.unsubscribe(),this.lSub?.unsubscribe(),this.pSub?.unsubscribe(),this.lastPostSub?.unsubscribe(),this.observer?.disconnect(),this.destroy$.next(!0),this.destroy$.complete()}};t.\u0275fac=function(r){return new(r||t)(O(Fe),O(B,2),O(Le,8),O(Ie),O(Ae))},t.\u0275cmp=y({type:t,selectors:[["app-articles-page"]],viewQuery:function(r,o){if(r&1&&(ge(o.scrollingRef,ut,5),ue(pt,5,ae)),r&2){_e();let l;pe(l=de())&&(o.lastPostList=l)}},standalone:!0,features:[he([B]),I],decls:20,vars:7,consts:[["empty",""],["loadingTemplate",""],["headerEl",""],["restoreScrollPosition",""],["lastPostItem",""],[1,"articlesPage"],[1,"articlesPage__header",3,"articlesPage__header--visible","ngStyle"],[1,"articlesPage__main"],[1,"container","articlesPage__container"],[1,"sidebar"],[1,"aboutPage"],[1,"moduleTitle"],[1,"aboutPage__text"],[1,"aboutPage__btnToTg","blueBtn","blueBtn--withPresentIcon"],[1,"pageContent"],[1,"errorMessage"],[1,"articlesPage__header",3,"ngStyle"],[1,"aboutPage__btnToTg","blueBtn","blueBtn--withPresentIcon",3,"click"],["src","assets/icons/present.svg","alt","p"],[1,"aboutPage__links","aboutPage__links--forDesktop"],[1,"aboutPage__links","aboutPage__links--forMobile"],[1,"downloadApp",3,"click"],[1,"downloadApp__title"],[1,"downloadApp__icon"],["alt","storeIcon",3,"src"],[1,"linkToApp"],["href","https://www.apple.com/app-store","target","_blank",1,"linkToApp__item"],["src","assets/images/store/linkIOSShort.svg","alt","linkIOS",1,"linkToApp__img"],["href","https://play.google.com","target","_blank",1,"linkToApp__item"],["src","assets/images/store/linkAndroid.svg","alt","linkAndroid",1,"linkToApp__img"],["href","https://appgallery.huawei.com","target","_blank",1,"linkToApp__item"],["src","assets/images/store/linkAppGallery.svg","alt","linkAppGallery",1,"linkToApp__img"],[1,"errorMessage__icon"],[1,"errorMessage__title"],[1,"errorMessage__text"],[1,"errorMessage__btn",3,"click","disabled"],["src","assets/icons/barsRotateFadeSpinner.svg","alt","spinner",1,"errorMessage__btnSpinner"],[4,"ngTemplateOutlet"],[1,"pageContent__articles"],[1,"pageContent__itemOfArticle","lastPostItem",3,"pageContent__itemOfArticle--viewed"],[1,"pageContent__itemOfArticle","lastPostItem"],[1,"pageContent__articleLink",3,"routerLink"],[3,"postData"],[1,"pageContent__itemOfArticle"],["target","_self",1,"pageContent__articleLink",3,"routerLink"],[1,"pageContent__articleLink"],[3,"postData","isLoading"],[1,"pageContent__itemOfArticle","hideInMobile"],["routerLink","/",1,"errorMessage__btn"],[1,"pageContent__articles","pageContent__articles--withGradientEffect"]],template:function(r,o){r&1&&(a(0,"div",5),_(1,mt,3,5,"div",6),a(2,"main",7)(3,"div",8)(4,"aside",9)(5,"div",10)(6,"h1",11),g(7,"\u041C\u0435\u0434\u0438\u0430"),s(),a(8,"div",12),g(9),s(),_(10,ft,3,0,"button",13)(11,Ct,9,2),s()(),a(12,"main",14),_(13,Pt,11,3,"div",15)(14,kt,2,1),s()()(),_(15,Et,1,0,"app-footer"),s(),_(16,Tt,10,0,"ng-template",null,0,D)(18,Lt,3,0,"ng-template",null,1,D)),r&2&&(c(),C(1,o.appWebview?-1:1),c(3),b("hiddenInMobile",o.appWebview),c(5),T(" ",o.getContent("articles-aboutPage-text")," "),c(),C(10,10),c(3),C(13,o.errorAfterGetAllArticles()?13:14),c(2),C(15,o.appWebview?-1:15))},dependencies:[Oe,ke,we,je,Te,Be],styles:['[_ngcontent-%COMP%]:root{--color-blue: #5532EB;--color-blue1: #4A4AC6;--color-pink: #FF99EC;--color-black: #000;--color-black1: #333;--color-black2: #111;--color-white: #fff;--color-gray: #807d7d;--color-gray1: #f2f3f4;--color-red: #e40038;--color-green: green;--color-text-gray: #a8a8a8;--color-light-gray: #eee}.articlesPage[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100%}.articlesPage[_ngcontent-%COMP%]   .articlesPage__header[_ngcontent-%COMP%]{position:sticky;top:calc(var(--header-height) - 20px);z-index:100;transition:.6s}.articlesPage[_ngcontent-%COMP%]   .articlesPage__header[_ngcontent-%COMP%]:after{content:"";position:absolute;height:20px;width:100%;background:linear-gradient(0deg,#fff0,#fff)}.articlesPage[_ngcontent-%COMP%]   .articlesPage__header--visible[_ngcontent-%COMP%]{top:0}.articlesPage[_ngcontent-%COMP%]   .articlesPage__main[_ngcontent-%COMP%]{flex:1}.articlesPage[_ngcontent-%COMP%]   .articlesPage__main[_ngcontent-%COMP%]   .articlesPage__container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:24px;margin-bottom:48px}@media (min-width: 768px){.articlesPage[_ngcontent-%COMP%]   .articlesPage__header[_ngcontent-%COMP%]{top:calc(var(--header-height) - 34px)}.articlesPage[_ngcontent-%COMP%]   .articlesPage__header[_ngcontent-%COMP%]:after{height:34px}.articlesPage[_ngcontent-%COMP%]   .articlesPage__header--visible[_ngcontent-%COMP%]{top:0}.articlesPage[_ngcontent-%COMP%]   .articlesPage__main[_ngcontent-%COMP%]   .articlesPage__container[_ngcontent-%COMP%]{flex-direction:row;margin-top:48px;margin-bottom:48px}}.sidebar[_ngcontent-%COMP%]{flex:1;margin-bottom:32px}@media (min-width: 768px){.sidebar[_ngcontent-%COMP%]{max-width:360px;margin-right:8%;margin-bottom:0}}@media (max-width: 767px){.hiddenInMobile[_ngcontent-%COMP%]{display:none}}.aboutPage[_ngcontent-%COMP%]   .aboutPage__text[_ngcontent-%COMP%]{margin-top:12px;line-height:1.5}.aboutPage[_ngcontent-%COMP%]   .aboutPage__btnToTg[_ngcontent-%COMP%], .aboutPage[_ngcontent-%COMP%]   .aboutPage__links[_ngcontent-%COMP%]{margin-top:24px}.aboutPage[_ngcontent-%COMP%]   .aboutPage__links--forDesktop[_ngcontent-%COMP%]{display:none}.aboutPage[_ngcontent-%COMP%]   .aboutPage__links--forMobile[_ngcontent-%COMP%]{display:block}.aboutPage[_ngcontent-%COMP%]   .aboutPage__btn[_ngcontent-%COMP%]{margin-top:24px}@media (min-width: 768px){.aboutPage[_ngcontent-%COMP%]   .aboutPage__links--forDesktop[_ngcontent-%COMP%]{display:block}.aboutPage[_ngcontent-%COMP%]   .aboutPage__links--forMobile[_ngcontent-%COMP%]{display:none}}.pageContent[_ngcontent-%COMP%]{flex:2}.pageContent[_ngcontent-%COMP%]   .pageContent__articles[_ngcontent-%COMP%]{display:flex;flex-direction:column;row-gap:48px}.pageContent[_ngcontent-%COMP%]   .pageContent__articles--withGradientEffect[_ngcontent-%COMP%]{-webkit-mask-image:linear-gradient(0deg,transparent,#000 400px);mask-image:linear-gradient(0deg,transparent,#000 400px)}.pageContent[_ngcontent-%COMP%]   .pageContent__loadMore[_ngcontent-%COMP%]{margin-top:32px;position:relative;height:50px}@media (min-width: 768px){.pageContent[_ngcontent-%COMP%]   .pageContent__articles[_ngcontent-%COMP%]{flex-wrap:wrap;flex-direction:row}.pageContent[_ngcontent-%COMP%]   .pageContent__articles[_ngcontent-%COMP%]   .pageContent__itemOfArticle[_ngcontent-%COMP%]{flex-basis:calc(50% - 12px)}.pageContent[_ngcontent-%COMP%]   .pageContent__articles[_ngcontent-%COMP%]   .pageContent__itemOfArticle[_ngcontent-%COMP%]:nth-child(odd){margin-right:24px}.pageContent[_ngcontent-%COMP%]   .pageContent__loadMore[_ngcontent-%COMP%]{margin-top:48px}}@media (max-width: 767px){.pageContent[_ngcontent-%COMP%]   .pageContent__articles[_ngcontent-%COMP%]   .pageContent__itemOfArticle.hideInMobile[_ngcontent-%COMP%]{display:none}}.pageContent__scrollToTopBtn[_ngcontent-%COMP%]{margin-left:auto}.pageContent__scrollToTopBtn[_ngcontent-%COMP%]   .scrollProgress[_ngcontent-%COMP%]{right:0}'],changeDetection:0});let e=t;return e})();export{Cn as ArticlesPageComponent};
